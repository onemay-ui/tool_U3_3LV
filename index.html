<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 3: Measurement & Electrical</title>
    <style>
        :root {
            /* U3 ‰ΩøÁî®ËóçÁ∂†Ëâ≤/ÈùíËâ≤Á≥ª‰ª•ÂçÄÂà• U1(Ëóç) Âíå U2(Á¥´) */
            --primary: #0891b2; 
            --primary-dark: #0e7490;
            --success: #22c55e;
            --error: #ef4444;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        #app {
            width: 100%;
            max-width: 480px; /* ÊâãÊ©üÂØ¨Â∫¶ÈôêÂà∂ */
            background-color: var(--card);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ÈÄöÁî®Ê®£Âºè */
        .screen {
            display: none;
            flex-direction: column;
            padding: 24px;
            flex: 1;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: flex;
        }

        h1, h2 {
            text-align: center;
            color: var(--text);
        }

        h1 { margin-bottom: 20px; font-size: 1.8rem; }
        h2 { margin-bottom: 10px; font-size: 1.2rem; color: #666; }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-bottom: 12px;
            transition: transform 0.1s, background-color 0.2s;
            width: 100%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: bold;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .input-group {
            margin-bottom: 24px;
        }

        input[type="text"] {
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            box-sizing: border-box;
            outline: none;
        }

        input[type="text"]:focus {
            border-color: var(--primary);
        }

        /* È†ÇÈÉ®Ë≥áË®äÂàó (ÂàÜÊï∏ËàáË®àÊôÇ) */
        .info-bar {
            display: flex;
            justify-content: space-between;
            background-color: #f0fdfa; /* Ê∑∫ÈùíËâ≤ËÉåÊôØ */
            padding: 10px 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-dark);
            border: 1px solid #ccfbf1;
        }

        /* È°åÁõÆÂç°Áâá */
        .question-card {
            background-color: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            text-align: center;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 16px;
            color: var(--primary-dark);
            line-height: 1.4;
        }

        .audio-btn {
            background-color: #cffafe;
            color: var(--primary-dark);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        
        .audio-btn:active { transform: scale(0.9); }
        .audio-btn svg { width: 28px; height: 28px; fill: currentColor; }

        /* ÈÅ∏È†ÖÁ∂≤Ê†º */
        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            background-color: white;
            border: 2px solid #e5e7eb;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn.correct {
            background-color: #dcfce7;
            border-color: var(--success);
            color: #166534;
        }

        .option-btn.wrong {
            background-color: #fee2e2;
            border-color: var(--error);
            color: #991b1b;
        }

        /* ÈÄ≤Â∫¶Ê¢ù */
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ÈóúÂç°ÊåáÁ§∫Âô® */
        .level-badge {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 5px;
            align-self: center;
        }

        .feedback-msg {
            text-align: center;
            min-height: 24px;
            margin-top: 5px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .correct-text { color: var(--success); }
        .wrong-text { color: var(--error); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Unit 3 Ê®ôÁ±§ */
        .unit-tag {
            background-color: #ccfbf1;
            color: #0f766e;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>

<div id="app">
    <!-- 1. ÁôªÂÖ•Áï´Èù¢ -->
    <div id="screen-login" class="screen active" style="justify-content: center; align-items: center;">
        <div class="unit-tag">UNIT 3</div>
        <h1>Measurement & Electrical</h1>
        <div style="text-align: center; margin-bottom: 40px; color: #666;">
            <p>Caliper, Multimeter, Solder...</p>
            <p style="font-size: 0.9rem;">ÈóúÈçµÈáèÊ∏¨ËàáÈõªÊ∞£Ë®≠ÂÇô</p>
        </div>
        
        <div class="input-group" style="width: 100%;">
            <input type="text" id="username" placeholder="Ë´ãËº∏ÂÖ•‰Ω†ÁöÑÂêçÂ≠ó (Enter Name)">
        </div>
        <button class="btn" onclick="startGame()">ÈñãÂßãÊåëÊà∞ (Start Challenge)</button>
    </div>

    <!-- 2. ÈÅäÊà≤‰∏ªÁï´Èù¢ (ÂÖ±Áî®) -->
    <div id="screen-game" class="screen">
        <div style="text-align: center;">
            <div class="level-badge" id="level-indicator">Level 1</div>
        </div>
        
        <!-- Ë≥áË®äÂàóÔºöÂàÜÊï∏ËàáÊôÇÈñì -->
        <div class="info-bar">
            <span>Score: <span id="current-score">0</span></span>
            <span>‚è±Ô∏è <span id="timer-display">00:00</span></span>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <h2 id="level-title" style="margin-top:0;">ÂñÆÂ≠óÈÖçÂ∞ç</h2>

        <div class="question-card">
            <button id="btn-speak" class="audio-btn" onclick="speakCurrentText()">
                <svg viewBox="0 0 24 24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0h-2.5l-5 5v5h5l5 5v-15z"/></svg>
            </button>
            <div id="question-text" class="question-text">Question Here</div>
        </div>

        <div id="feedback-msg" class="feedback-msg"></div>

        <div id="options-container" class="options-grid">
            <!-- JS ÂãïÊÖãÁîüÊàêÈÅ∏È†Ö -->
        </div>

        <button id="btn-next" class="btn" style="display: none;" onclick="nextQuestion()">‰∏ã‰∏ÄÈ°å (Next) ‚ûú</button>
    </div>

    <!-- 3. ÁµêÊûúÁï´Èù¢ -->
    <div id="screen-result" class="screen" style="justify-content: center; text-align: center;">
        <h1>üéâ Mission Complete!</h1>
        <p style="font-size: 1.2rem; margin-bottom: 5px;">Player: <span id="result-name" style="font-weight:bold; color:var(--primary);">User</span></p>
        
        <div style="background: #f0f9ff; padding: 25px; border-radius: 16px; margin: 20px 0; border: 2px solid #e0f2fe;">
            <div style="margin-bottom: 15px;">
                <p style="margin:0; color:#666; font-size: 0.9rem;">Final Score</p>
                <p style="font-size: 3.5rem; font-weight: bold; margin: 5px 0; color: var(--primary);" id="final-score">0</p>
            </div>
            <div style="border-top: 1px solid #cbd5e1; padding-top: 15px;">
                <p style="margin:0; color:#666; font-size: 0.9rem;">Total Time</p>
                <p style="font-size: 1.5rem; font-weight: bold; margin: 5px 0; color: #1e293b;" id="final-time">00:00</p>
            </div>
        </div>
        
        <button class="btn" onclick="restartGame()">ÂÜçÊåëÊà∞‰∏ÄÊ¨° (Play Again)</button>
    </div>
</div>

<script>
    // --- U3 Ë≥áÊñôÂçÄ (Ê†πÊìöÁî®Êà∂Êèê‰æõÁöÑ U3 ÂÖßÂÆπÊï¥ÁêÜ) ---
    const toolData = [
        { 
            id: 'measuring_tape', 
            en: 'Measuring tape', 
            zh: 'Êç≤Â∞∫', 
            core: ['Measure length', 'Flexible ruler'], 
            desc: 'It is a flexible ruler. We use it to measure length.' 
        },
        { 
            id: 'caliper', 
            en: 'Caliper', 
            zh: 'Âç°Â∞∫', 
            core: ['Precise measurement', 'Two tips'], 
            desc: 'It is for more precise measurements. It uses two tips to get the size.' 
        },
        { 
            id: 'micrometer', 
            en: 'Micrometer', 
            zh: 'ÂàÜÈáêÂç° (Ê∏¨ÂæÆË®à)', 
            core: ['Measure small things', 'Very accurate'], 
            desc: 'It measures very small things. It is very accurate. It is also called a screw gauge.' 
        },
        { 
            id: 'multimeter', 
            en: 'Multimeter', 
            zh: 'Ëê¨Áî®ÈõªË°®', 
            core: ['Measure volt & current', 'Electronic device'], 
            desc: 'It is an electronic device. It can measure volt, current, and resistance.' 
        },
        { 
            id: 'soldering_iron', 
            en: 'Soldering iron', 
            zh: 'ÁÉôÈêµ', 
            core: ['Melt solder', 'Make a strong joint'], 
            desc: 'It gets very hot. We use it to heat and melt solder. It makes a strong joint.' 
        },
        { 
            id: 'screw', 
            en: 'Screw', 
            zh: 'Ëû∫Áµ≤', 
            core: ['Helical thread', 'Hold together'], 
            desc: 'A screw has a helical thread. It is a fastener to hold together objects.' 
        },
        { 
            id: 'washer', 
            en: 'Washer', 
            zh: 'Â¢äÂúà', 
            core: ['Distribute load', 'Disk-shape plate'], 
            desc: 'It is a disk-shape plate. It helps to distribute the load of a screw.' 
        },
        { 
            id: 'hose_clamp', 
            en: 'Hose clamp', 
            zh: 'ÁöÆÁÆ°Â§æ', 
            core: ['Tighten a hose', 'Seal a fitting'], 
            desc: 'This device is used to tighten and seal a hose onto a fitting.' 
        }
    ];

    // --- ÁãÄÊÖãÁÆ°ÁêÜ ---
    let state = {
        name: '',
        currentLevel: 1,
        qIndex: 0,
        score: 0,
        questions: [],
        startTime: 0,
        timerInterval: null
    };

    const synth = window.speechSynthesis;

    // --- ÂàùÂßãÂåñËàáÂ∞éËà™ ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame() {
        const nameInput = document.getElementById('username');
        if (!nameInput.value.trim()) {
            alert('Please enter your name!');
            return;
        }
        state.name = nameInput.value;
        state.score = 0;
        
        // ÂïüÂãïË®àÊôÇÂô®
        state.startTime = Date.now();
        if(state.timerInterval) clearInterval(state.timerInterval);
        state.timerInterval = setInterval(updateTimer, 1000);

        startLevel(1);
    }

    // --- Ë®àÊôÇÂô®ÂäüËÉΩ ---
    function updateTimer() {
        const now = Date.now();
        const diff = Math.floor((now - state.startTime) / 1000);
        const min = Math.floor(diff / 60).toString().padStart(2, '0');
        const sec = (diff % 60).toString().padStart(2, '0');
        document.getElementById('timer-display').textContent = `${min}:${sec}`;
    }

    function getFormattedTime() {
        return document.getElementById('timer-display').textContent;
    }

    function stopTimer() {
        clearInterval(state.timerInterval);
    }

    function startLevel(level) {
        state.currentLevel = level;
        state.qIndex = 0;
        
        // Êõ¥Êñ∞ UI
        document.getElementById('level-indicator').textContent = `Level ${level}`;
        document.getElementById('current-score').textContent = state.score;
        
        // ÁîüÊàêÈ°åÁõÆ
        generateQuestions(level);
        showScreen('screen-game');
        renderQuestion();
    }

    // --- È°åÁõÆÁîüÊàêÈÇèËºØ (U3) ---
    function generateQuestions(level) {
        state.questions = [];
        let pool = [...toolData]; // Ë§áË£ΩË≥áÊñô

        if (level === 1) {
            // Level 1: ‰∏≠Êñá -> Ëã±Êñá (Ë™ûÈü≥)
            document.getElementById('level-title').textContent = "Listen & Match (ËÅΩÈü≥Ëæ®‰Ωç)";
            pool.sort(() => Math.random() - 0.5);
            pool.forEach(item => {
                let options = [item.en];
                let distractors = toolData.filter(t => t.id !== item.id).sort(() => Math.random() - 0.5).slice(0, 2);
                options.push(distractors[0].en, distractors[1].en);
                options.sort(() => Math.random() - 0.5);

                state.questions.push({
                    type: 'L1',
                    questionText: item.zh,
                    speakText: item.en,
                    correct: item.en,
                    options: options,
                    item: item
                });
            });

        } else if (level === 2) {
            // Level 2: Â∑•ÂÖ∑Âêç -> Ê†∏ÂøÉÊèèËø∞ (Ë™ûÈü≥)
            document.getElementById('level-title').textContent = "Key Features (Ê†∏ÂøÉÁâπÂæµ)";
            pool.sort(() => Math.random() - 0.5);
            pool.forEach(item => {
                let correctCore = item.core[Math.floor(Math.random() * item.core.length)];
                
                let options = [correctCore];
                let otherTools = toolData.filter(t => t.id !== item.id);
                // ÂèñÂè¶Â§ñÂÖ©ÂÄãÂ∑•ÂÖ∑ÁöÑ Core
                let d1 = otherTools[0].core[Math.floor(Math.random() * otherTools[0].core.length)];
                let d2 = otherTools[1].core[Math.floor(Math.random() * otherTools[1].core.length)];
                
                options.push(d1, d2);
                options.sort(() => Math.random() - 0.5);

                state.questions.push({
                    type: 'L2',
                    questionText: item.en, 
                    speakText: `Which phrase describes the ${item.en}?`,
                    correct: correctCore,
                    options: options,
                    item: item
                });
            });
        } else if (level === 3) {
            // Level 3: Âè•Â≠êÂ°´Á©∫ (ÁÑ°Ë™ûÈü≥)
            document.getElementById('level-title').textContent = "Description (ÂäüËÉΩÊèèËø∞)";
            pool.sort(() => Math.random() - 0.5);
            pool.forEach(item => {
                // ÈÅÆËîΩÂè•Â≠ê‰∏≠ÁöÑÈóúÈçµÂ≠ó (ÈÅøÂÖçÁõ¥Êé•ÈÄÅÂàÜ)
                let desc = item.desc;
                
                let options = [item.en];
                let distractors = toolData.filter(t => t.id !== item.id).sort(() => Math.random() - 0.5).slice(0, 2);
                options.push(distractors[0].en, distractors[1].en);
                options.sort(() => Math.random() - 0.5);

                state.questions.push({
                    type: 'L3',
                    questionText: desc,
                    speakText: null, 
                    correct: item.en,
                    options: options,
                    item: item
                });
            });
        }
    }

    // --- Ê∏≤ÊüìËàá‰∫íÂãï ---
    function renderQuestion() {
        const q = state.questions[state.qIndex];
        const total = state.questions.length;

        document.getElementById('progress-fill').style.width = `${(state.qIndex / total) * 100}%`;
        document.getElementById('question-text').textContent = q.questionText;
        document.getElementById('feedback-msg').textContent = '';
        document.getElementById('feedback-msg').className = 'feedback-msg';
        document.getElementById('btn-next').style.display = 'none';

        const speakBtn = document.getElementById('btn-speak');
        if (q.speakText) {
            speakBtn.style.visibility = 'visible';
            setTimeout(() => speakCurrentText(), 600);
        } else {
            speakBtn.style.visibility = 'hidden';
        }

        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.correct);
            container.appendChild(btn);
        });
    }

    function speakCurrentText() {
        const q = state.questions[state.qIndex];
        if (q && q.speakText) {
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(q.speakText);
            utter.lang = 'en-US';
            utter.rate = 0.9; 
            synth.speak(utter);
        }
    }

    function checkAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const isCorrect = selected === correct;
        const feedback = document.getElementById('feedback-msg');

        if (isCorrect) {
            btn.classList.add('correct');
            state.score += 10;
            document.getElementById('current-score').textContent = state.score;
            feedback.textContent = "Correct! (Á≠îÂ∞ç‰∫Ü)";
            feedback.classList.add('correct-text');
        } else {
            btn.classList.add('wrong');
            feedback.textContent = `Answer: ${correct}`;
            feedback.classList.add('wrong-text');
            allBtns.forEach(b => {
                if (b.textContent === correct) b.classList.add('correct');
            });
        }

        document.getElementById('btn-next').style.display = 'flex';
    }

    function nextQuestion() {
        state.qIndex++;
        if (state.qIndex < state.questions.length) {
            renderQuestion();
        } else {
            if (state.currentLevel < 3) {
                alert(`Level ${state.currentLevel} Completed! Next Level.`);
                startLevel(state.currentLevel + 1);
            } else {
                stopTimer();
                showResult();
            }
        }
    }

    function showResult() {
        showScreen('screen-result');
        document.getElementById('result-name').textContent = state.name;
        document.getElementById('final-score').textContent = state.score;
        document.getElementById('final-time').textContent = getFormattedTime();
    }

    function restartGame() {
        state.score = 0;
        showScreen('screen-login');
        // ÈáçÁΩÆÊôÇÂÖà‰∏çÈñãÂßãË®àÊôÇÔºåÁ≠âÊåâ‰∏ã Start ÊâçÈñãÂßã
    }
</script>

</body>
</html>